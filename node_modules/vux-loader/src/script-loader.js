'use strict'

const utils = require('loader-utils')

module.exports = function (source) {
  const config = utils.getLoaderConfig(this, "vux")
  if (!config.plugins || !config.plugins.length) {
    return source
  }
  return importParser(source, config)
}

function importParser (source) {
  if (!/import \{/.test(source) && !/vux/) {
    return source
  }
  source = source.replace(/import.*{(.*)}.*from 'vux'/g, function (match) {
    if (!match) return match
    const components = match.split('{')[1].split('}')[0].split(',').map(function(one){return one.replace(/\s+/g,'')})
    let str = ''
    str = components.map(function(item) {
      if (/Item/.test(item)) {
        return ''
      } else {
        const name = item.replace(/([A-Z])/g, function($1){return "-"+$1.toLowerCase();}).slice(1)
        if (item !== 'Swiper' && components.indexOf(item + 'Item') > 0) {
          return `import { ${item}, ${item}Item } from 'vux/src/components/${name}'`
        } else {
          return `import ${item} from 'vux/src/components/${name}'`
        }
      }
    }).join('\n')
    return str
  })

  return source
}
